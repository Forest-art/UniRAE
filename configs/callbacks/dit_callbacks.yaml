# DiT Training Callbacks Configuration

defaults:
  - model_checkpoint
  - model_summary
  - rich_progress_bar
  - _self_

# Model Checkpoint Callback
model_checkpoint:
  _target_: lightning.pytorch.callbacks.ModelCheckpoint
  dirpath: ${paths.output_dir}/checkpoints
  filename: "dit_epoch_{epoch:04d}_step_{step:08d}"
  monitor: "val/loss"
  mode: "min"
  save_last: True
  save_top_k: 3
  auto_insert_metric_name: False
  save_weights_only: False
  every_n_train_steps: null
  every_n_epochs: 10
  save_on_train_epoch_end: null

# EMA Callback for DiT training
ema_callback:
  _target_: src.callbacks.ema_callback.EMACallback
  decay: 0.9995
  ema_interval: 1
  validate_original_weights: False

# Sampling Callback for periodic image generation during training
sampling_callback:
  _target_: src.callbacks.sampling_callback.SamplingCallback
  sample_every_n_steps: 10000
  num_samples: 64
  num_steps: 50
  cfg_scale: 1.0
  save_images: True
  log_to_wandb: True

# Evaluation Callback for FID computation
evaluation_callback:
  _target_: src.callbacks.eval_callback.EvaluationCallback
  eval_every_n_steps: 25000
  num_samples: 10000
  batch_size: 100
  fid_reference_path: ${eval.reference_npz_path}
  compute_fid: True
  compute_is: True

# Model Summary
model_summary:
  max_depth: -1

# Rich Progress Bar
rich_progress_bar:
  refresh_rate: 1
